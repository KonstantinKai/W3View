<!DOCTYPE html>
<html>
<head>
<title>
Hallo
</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8" />
<style>

</style>
</head>
<body>

<script id='compo' type="text/compo">

  <div as="list-item" tagName="tr">
    <div tagName="td" style="padding:20px;">
      Number of elements in the array:
      <h1 ref="id"></h1>
    </div>
    <div tagName="td" style="padding:20px;">
      Updating time:
      <h1 ref="content"></h1>
    </div>
    <constructor>
      this.controlSum=function(data){
        return data.id+data.content;
      }
      this.onSetData=function(data){
        this.ref.id.innerText=data.id;
        this.ref.content.innerText=data.content;
      };
    </constructor>
  </div>

  <div as="hallo-world">
    <input ref="input" placeholder="type here your name">
    <h1>Hallo <span ref="name">Anonimous</span>!</h1>
    <constructor>
      this.ref.input.onkeyup=function(e){
        this.setData(this.ref.input.value);
      }.bind(this);
      this.onSetData = function(data){
        this.ref.name.innerText = data || 'Anonimous';
      };
    </constructor>
  </div>

  <div as="app">   
    <h1>Hallo</h1>
    <div ref="content">
    </div>
    <array-iterator ref="list" useTag="table" style="border: 1px solid black;">
      <list-item 
        style="font-weight:bold;background-color:#FFFFFF;color:#000000;">
      </list-item>
      <list-item 
        style="font-weight:bold;color:#FFFFFF;background-color:#000000;">
      </list-item>
      <list-item 
        style="font-weight:bold;color:white;background-color:green;">
      </list-item>
    </array-iterator>
    <constructor>
      console.log(this.factory.appConf.appName);
      this.onSetData=function(data){
        this.ref.list.setData(data);
        this.ref.content.innerText = data.date;
      };
    </constructor>
  </div>

</script>

<div id="appb"></div>

<script type="text/javascript" src="compo.js"></script>
<script type="text/javascript">

  var compo = new Compo({appName: 'The application'});
  compo.parse(document.getElementById('compo').textContent);
  //console.dir(compo);
  var b=compo.create('app');

  b.mount(document.getElementById('appb'));

  console.log(compo.registry);
  var list = [];

  b.setData(list);
  var time=new Date().getTime();
  var st=time, ct=0;

  var interval=setInterval(function(){
    ct=new Date().getTime();
    
    list.unshift({id:list.length+1, content:(ct-time)});
    time=ct;
    list.date = new Date();
    b.setData(list);

    var size=100;

    if(list.length >= size){
      console.log('adding',list.length,'by one',ct-st, 'average', (ct-st)/list.length);

      var nst = new Date().getTime();
      clearInterval(interval);
      
      //return;
      interval=setInterval(function(){
          ct = new Date().getTime();
          list.shift();
          time = ct;
          b.setData(list);
          if (list.length===size-50) {
            clearInterval(interval);
            console.log('removing', 50, 'by one',ct-nst, 'average', (ct-nst)/50);
            console.log('total',ct-st);
            b.setData([]);
            setTimeout(function(){
              createAll(list);
              setTimeout(
                function(){
var st=new Date().getTime();
                  b.innerHTML=(b.innerHTML+'');
console.log('set innerHTML=innerHTML ', list.length, 'rows in', new Date().getTime()-st);
                },0
              );
            }, 0);
            console.log(b);
          }
        },0
      );
    }

  },0);

  function createAll(list){
    var st=new Date().getTime();
    b.setData(list);
    console.log('rebuld all', list.length, 'rows in', new Date().getTime()-st);
  }
  
</script>
</body>
</html>
